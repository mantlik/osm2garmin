<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML 5.0//EN" "http://docbook.org/ns/docbook/DTD/docbook.dtd" >

<book xmlns="http://docbook.org/ns/docbook" 
      xmlns:xi="http://www.w3.org/2001/XInclude"
      version="5.0" xml:id="guide-index">
    <info>
        <title>OpenStreetMap Garmin Maps Generator</title>
        <subtitle>User's guide</subtitle>
        <mediaobject>
            <imageobject>
                <imagedata fileref="splash.png"/>
            </imageobject>
        </mediaobject>
        <copyright>
            <year>      
                <?dbtimestamp format="Y"?>
            </year>
            <holder>RNDr. Frantisek Mantlik</holder>
        </copyright>
    </info>
    <chapter xml:id="getting-started">
        <info>
            <title>Getting started</title>
        </info>
        <section>
            <info>
                <title>Introduction</title>
            </info>
            <para>
                Osm2garmin combines OpenStreetMap (OSM) geographic data with 
                contours from NASA's SRTM data and generates maps for Garmin GPS receivers. 
            </para>
            <para>
                It is a total solution, downloading the required data, processing 
                the data through 3 external tools (Mkgmap, Splitter and Osmosis - 
                included in the distribution) and creating map files that can be used 
                by Garmin GPSs or loaded into MapSource/BaseCamp/QLandkarte.
            </para>
            <para>
                The program is a Netbeans Rich Client application running within 
                Sun Java virtual machine.
            </para>
            <formalpara>
                <info>
                    <title>Map creation sequence:</title>
                </info>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>OSM Planet and required SRTM data are downloaded.</para>
                        </listitem>
                        <listitem>
                            <para>Contours are generated from SRTM data.</para>
                        </listitem>
                        <listitem>
                            <para>OSM data are converted to Garmin format.</para>
                        </listitem>
                        <listitem>
                            <para>gmapsupp.img and supporting files are created.</para>
                        </listitem>
                    </itemizedlist>
                </para>
            </formalpara>
            <para>
                For subsequent updates of processed regions only OSM Planet updates 
                are downloaded and these are joined to existing contour data 
                to generate updated map files.
            </para>
        </section>
        <section>
            <info>
                <title>Quick start</title>
            </info>
            <para>
                Follow these instructions to create maps of one or more predefined regions:
            </para>
            <itemizedlist>
                <listitem>
                    <para>
                        Click 
                        <inlinemediaobject>
                            <imageobject>
                                <imagedata fileref="Globe32.png"/>
                            </imageobject> 
                        </inlinemediaobject> or select Tools-Options to adjust
                        program settings. Click appropriate tab for desired settings group.
                    </para>
                    <para>
                        Default settings will produce a set of Garmin maps covering the whole globe. You can
                        adjust all settings according to your needs.
                    </para>
                    <para>
                        For first time use, set directory locations in the 
                        “Processing Parameters” tab and select regions to process.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Click "Start" to begin data download and map generation.                        
                    </para>
                    <para>
                        Program status is displayed in the Output window.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Wait until maps download and creation process is finished. It can take 
                        long time (12+ hours), especially on the first run.                        
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Copy maps to the GARMIN folder of the memory card of your Garmin instrument 
                        and/or install maps into MapSource/BaseCamp/QLandkarte.                    
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Repeat on a regular basis to add OSM updates to your maps.
                    </para>
                </listitem>
            </itemizedlist>
        </section>
    </chapter>
    <chapter xml:id="reference">
        <info>
            <title>Reference</title>
        </info>
        <para>
            This section explains the program's controls/settings, providing 
            User control. It is organized by program windows/tabs.
        </para>
        <section xml:id="main-window">
            <info>
                <title>Main window controls</title>
            </info>
            <para>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="application.png"/>
                    </imageobject>
                </mediaobject>
            </para>
            <para>
                The main window is where you start/stop/exit the program, view map 
                generation progress and access settings.  We will briefly review 
                the controls found here - note that hovering the mouse over an 
                item provides a brief description.  
            </para>
            <para>
                There are three main window sections; menus/toolbars, 
                processing/progress and output.
            </para>
            <section xml:id="main-window-toolbar">
                <info>
                    <title>Toolbar</title>
                </info>
                <variablelist>
                    <?dbfo list-presentation="blocks"?>
                    <varlistentry>
                        <term>Options</term>
                        <listitem>
                            <para>
                                Allows changing of program settings – Downloads, 
                                Processing Parameters and Regions.
                            </para>
                            <para>
                                This is the most frequently used window.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Open/Close Argument file editors</term>
                        <listitem>
                            <para>
                                Opens tabs in the “Progress Area” to edit arguments 
                                passed to the program and external tools.
                            </para>
                            <para>For advanced users only.</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Save all, Undo, Redo</term>
                        <listitem>
                            <para>
                                Controls text editing of the argument files.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Memory</term>
                        <listitem>
                            <para>
                                Displays the current/committed Java heap memory 
                                usage. Clicking will force a Java garbage 
                                collection action.
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
                <para>
                    Icons can be placed/removed from the toolbar by selecting 
                    View - Toolbar and clicking on the item.
                </para>
                <para>
                    Toolbar actions can be also accessed via main menu.
                </para>
            </section>
            <section xml:id="main-window-progress">
                <info>
                    <title>Progress bars</title>
                </info>
                <para>
                    Report progress of the various steps to generate maps.
                    Reports “Completed” as each step successfully finishes.
                </para>
                <para>
                    The “start” and “stop” buttons begin and stop map generation.  
                    These buttons switch to “exit” and “restart” upon program completion. 
                    See the Error Messages section for additional information.
                </para>
            </section>
            <section xml:id="main-window-output">
                <info>
                    <title>Output window</title>
                </info>
                <para>
                    Displays internal program activity messages and is helpful 
                    for tracking errors.  Output is copied to the report.log 
                    file in the working directory.  Log file is cleaned upon 
                    program restart.
                </para>
            </section>
        </section>
        <section xml:id="settings">
            <info>
                <title>Program settings</title>
            </info>
            <para>
                Click 
                <inlinemediaobject>
                    <imageobject>
                        <imagedata fileref="Globe32.png"/>
                    </imageobject> 
                </inlinemediaobject> or select Tools-Options to open Program Settings
                dialog.
            </para>
            <para>
                Changes are saved by selecting the “OK” button (lower right corner). 
                They are retained and used for subsequent map generation session(s) 
                and are not region specific
            </para>
            <para>
                Export and Import buttons are not used by Osm2garmin, they provide 
                internal Netbeans functionality and can be safely ignored by most users.
            </para>
            <section xml:id="sources">
                <info>
                    <title>Download sources</title>
                </info>
                <para>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="download_sources.png"/>
                        </imageobject>
                    </mediaobject>
                </para>
                <variablelist>
                    <?dbfo list-presentation="blocks"?>
                    <varlistentry>
                        <term>SRTM3 download URL</term>
                        <listitem>
                            <para>
                                URL for downloading SRTM data. If local/company mirror of SRTM3 data
                                is available, this location can be changed. Please note that
                                HTTP protocol only is supported.
                            </para>
                            <para>
                                Default value: http://dds.cr.usgs.gov/srtm/version2_1/SRTM3/
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Torrents download URL</term>
                        <listitem>
                            <para>
                                URL for downloading OSM planet file torrents. 
                                There is no need to change the default value 
                                under normal circumstances.
                                This option affects BitTorrent download only.                            
                            </para>
                            <para>
                                Default value: http://osm-torrent.torres.voyager.hr/files/
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Planet download mirrors</term>
                        <listitem>
                            <para>
                                List of mirrors for HTTP downloads of the planet.pbf file 
                                one per line. Download mirror is randomly selected
                                upon program startup. This option affects HTTP download only.
                            </para>
                            <para>
                                Default value:
                            </para>
                            <simplelist>
                                <member>http://ftp.heanet.ie/mirrors/openstreetmap.org/pbf</member>
                                <member>http://ftp5.gwdg.de/pub/misc/openstreetmap/planet.openstreetmap.org//pbf</member>
                            </simplelist>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Planet update mirrors</term>
                        <listitem>
                            <para>
                                List of mirrors for downloading OSM updates one item per line. 
                                Update mirror is randomly selected each run.
                            </para>
                            <para>
                                Default value:
                            </para>
                            <simplelist>
                                <member>http://ftp.heanet.ie/mirrors/openstreetmap.org</member>
                                <member>http://ftp5.gwdg.de/pub/misc/openstreetmap/planet.openstreetmap.org</member>
                                <member>http://planet.openstreetmap.org</member>
                            </simplelist>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Download method</term>
                        <listitem>
                            <para>
                                Method for initial planet file download. Default 
                                method is BitTorrent.                            
                            </para>
                            <warning>
                                <para>
                                    HTTP download method is deprecated and will be removed 
                                    in future releases.
                                </para>
                            </warning>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>BitTorrent port range</term>
                        <listitem>
                            <para>
                                Lists the range of ports for BitTorrent downloads. 
                                The first available port is used.
                            </para>
                            <para>
                                For best download performance, ports open 
                                to the Internet should be listed.                             
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>BitTorrent maximum speed</term>
                        <listitem>
                            <para>
                                Speed limit for BitTorrent download/upload in kb/s. 
                                Value of 0 (zero) sets unlimited speed (default).
                            </para>
                            <para>
                                Program restart is required for changes to take effect.
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </section>
            <section xml:id="parameters">
                <info>
                    <title>Processing parameters</title>
                </info>
                <para>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="parameters.png"/>
                        </imageobject>
                    </mediaobject>
                </para>
                <variablelist>
                    <?dbfo list-presentation="blocks"?>
                    <varlistentry>
                        <term>Working directory</term>
                        <listitem>
                            <para>
                                Directory for saving all program, OSM planet and contoru data.
                            </para>
                            <note>
                                <para>
                                    The Osm2garmin program needs at least
                                    150-200 Gbyte of free space to save map data for the whole Earth.
                                </para>
                            </note>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Maps directory</term>
                        <listitem>
                            <para>
                                Directory where final maps will be saved. 
                                Each region is in a separate subdirectory.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>SRTM data directory</term>
                        <listitem>
                            <para>
                                Directory where downloaded SRTM3 data is saved. 
                                If you have a local SRTM mirror available, you can point 
                                to that directory. Data available in this directory will 
                                not be downloaded but missing (incomplete) data will be.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Skip planet updates</term>
                        <listitem>
                            <para>
                                Skip downloading planet file updates and updating. Regions directories are not cleared
                                when this option is checked. Regions maps are not refreshed. If regions boundaries were
                                changed since last update, processing results will be incorrect or processing of the
                                affected regions will fail.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Elevation difference threshold</term>
                        <listitem>
                            <para>
                                Contours are processed in one of three groups.  To create the groups, 
                                two “elevation difference thresholds” are set to establish “break points” 
                                between the groups. 
                            </para>
                            <para>
                                The minor group contains tiles where the elevation difference 
                                is less than the first threshold, the major group where the difference is 
                                greater than the second threshold and the intermediate group is between 
                                the two values. 
                            </para>
                            <para>
                                Default settings are 500 and 2400.                            
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Contours interval</term>
                        <listitem>
                            <para>
                                Sets the elevation distance between contours that are calculated 
                                within each group. 
                            </para>
                            <para>
                                Default values are minor 25, intermediate 50 and major 100.                            
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Maximum number of contours in a single 3x3 arc sec cell </term>
                        <listitem>
                            <para>
                                Determines the density of contours in a tile 3x3 arcSecs tile. 
                                If more contours appear in a single tile than this value, 
                                no contours are plotted inside the tile.
                            </para>
                            <para>
                                Default setting is 4.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>No. of SRTM3 tiles in a single contours file</term>
                        <listitem>
                            <para>
                                Degree of aggregation of SRTM tiles in each contour file. 
                                A higher number makes the contours processing faster but 
                                needs more memory and increases overlap at region boundaries.
                            </para>
                            <para>
                                Default setting is 5, i.e. each single contours file
                                aggregates 5 x 5 = 25 SRTM tiles.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>SRTM contours shift correction</term>
                        <listitem>
                            <para>
                                In some areas, SRTM data have a systematic processing shift. 
                                This results in contours being shifted relative to OSM data. 
                                If your map has this problem, a correction can be introduced here. 
                            </para>
                            <para>
                                E.g. for some regions in Central Europe, value of 0.0004167 (= 1/2400) degree
                                in both directions synchronizes SRTM and OSM data.
                            </para>
                            <para>
                                Default setting is 0 in both directions.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Exclusive run of external tools</term>
                        <listitem>
                            <para>
                                When selected, no simultaneous run of more than one external tool 
                                (Osmosis, Mkgmap or Splitter) is allowed. Useful if you experience 
                                out-of-memory problems but extends processing time. 
                            </para>
                            <para>
                                See the 
                                <link linkend="more_memory">Assign more memory to the program</link> 
                                section for more info.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Skip planet update</term>
                        <listitem>
                            <para>
                                When selected, updates to the OSM Planet file are not downloaded 
                                and the Planet file is not updated. Recent additions to OSM (buildings, POI, roads) 
                                that were posted after your last update will not be added to your map. 
                            </para>
                            <para>
                                This option can save considerable processing time.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Update regions using current planet file</term>
                        <listitem>
                            <para>
                                When selected, the Planet file is updated using the update file 
                                that was previously downloaded. Only active when Skip planet update 
                                has been selected.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Delete old maps when processing starts</term>
                        <listitem>
                            <para>
                                When selected, the files in the regions selected for processing 
                                are deleted upon program execution. Downloaded OSM data and previously 
                                computed contours are not deleted. 
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Splitter overlap value</term>
                        <listitem>
                            <para>
                                Increase this value if you experience routing problems
                                over tiles boundaries.
                            </para>
                            <para>
                                A value of 10,000 has been reported to correct routing problems. 
                            </para>
                            <para>
                                Default setting is 2,000.
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
                <note>
                    <para>
                        Default contour settings were chosen to generate maps 
                        for the continental sized, predefined default regions 
                        and display them correctly on most common Garmin GPS's. 
                    </para>
                    <para>
                        Settings are usually changed only when maps for user defined 
                        regions are created and more/less detail is required. 
                    </para>
                    <para>
                        Caution should be exercised as changing settings can result 
                        in increased map size, required memory, processing time and/or degraded view-ability. 
                    </para>
                </note>
                <caution>
                    If any parameter affecting contours generation is changed, 
                    the contours directory in the working directory must be cleaned 
                    (emptied) to reprocess contour data.
                </caution>
                <note>
                    <para>
                        Contour generation is a complex process. Users should read the “Contour generating” 
                        explanation in the appendix for more information before changing
                        default parameters.
                    </para>
                </note>
            </section>
            <section xml:id="regions">
                <info>
                    <title>Regions</title>
                </info>
                <para>
                    <mediaobject>
                        <imageobject>
                            <imagedata fileref="regions.png"/>
                        </imageobject>
                    </mediaobject>
                </para>
                <para>
                    The Regions table defines individual regions for map generation. 
                </para>
                <para>
                    Each rectangular region is defined by a name and bounding coordinates. 
                    The Display button opens a map of the region in a browser window 
                    and saves a HTML page in the working directory. 
                </para>
                <para>
                    Selecting the "Enabled" box generates maps for the region. 
                    Regions are processed from top to bottom and the sequence 
                    is changed by highlighting a region and using the Move up 
                    and Move down buttons. 
                </para>
                <para>
                    New regions are created by selecting the “Add” button. 
                    Values are entered/changed by double-clicking or using the F2 key 
                    for each cell of the table. To define region boundaries, visualize a box 
                    with North at the top.  Lat1 is the bottom of the box, Lat2 the top, 
                    Long1 the left side and Long2 the right side. 
                    So Lat1&lt;Lat2 and Long1&lt;Long2. Both positive and negative values 
                    are used for Lat/Long.
                </para>
                <para>
                    Delete button deletes the highlighted region.
                </para>
                <para>
                    When a file named &lt;region_name&gt;.poly exists in the working directory, 
                    a region is defined by polygon coordinates from the .poly file. 
                    Coordinates in the Regions table represent the bounding box of the polygon 
                    and are not editable.
                </para>
                <para>
                    More information about polygon file formats, download sources and examples are at:
                    <link xmlns:xlink="http://www.w3.org/1999/xlink" 
                          xlink:href="http://wiki.openstreetmap.org/wiki/Osmosis/Polygon_Filter_File_Format"/>
                </para>
            </section>
            <section xml:id="other-sections">
                <info>
                    <title>Other sections of the Options dialog</title>
                </info>
                <variablelist>
                    <?dbfo list-presentation="blocks"?>
                    <varlistentry>
                        <term>General</term>
                        <listitem>
                            <para>
                                Web Browser and Proxy settings.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Keymap</term>
                        <listitem>
                            <para>
                                Defines program's keyboard shortcuts.
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Miscellaneous</term>
                        <listitem>
                            <para>
                                Controls file settings and windows behaviors.
                            </para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </section>
        </section>    
    </chapter>
    <chapter xml:id="results">
        <info>
            <title>Using your map files</title>
        </info>
        <para>
            When map generation finishes, the following files are created in each 
            region's directory:        
        </para>
        <variablelist>
            <?dbfo list-presentation="blocks"?>
            <varlistentry>
                <term>gmapsupp.img - Garmin GPS mapset file</term>
                <listitem>
                    <para>
                        The compiled mapset for Garmin GPSs. Copy this file into 
                        the Garmin folder on the external memory card of the GPS. 
                        Most Garmin GPS's support only one mapset at a time.                     
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>3/4/5/6xxxxxxx.img - contours maps in Garmin format</term>
                <term>7xxxxxxx.img - OSM data converted to Garmin format</term>
                <listitem>
                    <para>
                        The numbered individual map files (XXX tiles) which were 
                        compiled together to create the gmapsupp.img mapset file in the final 
                        processing step. These files can be registered to, and used in, 
                        MapSource/BaseCamp by using methods described later.                    
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>installer.bat</term>
                <listitem>
                    <para>
                        This Windows script creates the necessary registry items 
                        for MapSource/BaseCamp to recognize your generated maps.                     
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>uninstaller.bat</term>
                <listitem>
                    <para>
                        This Windows script uninstalls maps from MapSource/BaseCamp. 
                        You must uninstall and reinstall maps if you generate updated 
                        maps or change the number/order of regions in the Regions table.                    
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>osmmap*.*</term>
                <listitem>
                    <para>
                        Files used by MapSource/BaseCamp.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>osmmap.nsi</term>
                <listitem>
                    <para>
                        Script for the Nullsoft Scriptable Install System (NSIS) which uses MakeNSIS 
                        or MakeNSISW to create a Windows installer and files for MapSource/BaseCamp used 
                        on a remote computer.  At the destination computer when 
                        &lt;region_name&gt;.exe is run, maps are unpacked to 
                        c:\garmin\maps\&lt;region_name&gt;. Maps can be un-installed and deleted using 
                        standard "Windows" methods, e.g. "Add/remove programs" or "Programs and functions" 
                        control panel items. 
                    </para>
                    <para>
                        You can obtain NSIS from 
                        <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://nsis.sourceforge.net"/>.
                    </para>
                    <caution>
                        <para>
                            Note that if map size exceeds 2Gb, installer creation can fail because 
                            of default /SOLID compressor parameter in osmmap.msi script. To avoid this problem, 
                            either remove "/SOLID" parameter from SetCompressor command in the script, 
                            or use /X"SetCompressor /FINAL LZMA" startup parameter for MakeNSIS.                        
                        </para>
                    </caution>
                    <note>
                        <para>
                            MakeNSIS command can be e.g.:
                        </para>
                        <programlisting>"C:\Program Files\NSIS\makensis.exe" /X"SetCompressor /FINAL lzma" osmmap.nsi</programlisting>
                        <para>
                            Even without "/SOLID" parameter, total size of resulting installer file cannot exceed 2 Gb, 
                            which corresponds to gmapsupp.img size approx. 3 Gb.
                            This is an unbreakable limitation of current version of NSIS.
                        </para>
                        <para>
                            Maps installed via NSIS installer are not compatible with installer.bat / uninstaller.bat method. 
                            Uninstaller.bat will NOT uninstall maps installed via NSIS and vice-versa.
                        </para>
                    </note>
                </listitem>
            </varlistentry>
        </variablelist>
        <warning>
            <para>
                Do NOT delete/overwrite commercial maps on the GPS's internal memory or external card 
                - use a new card instead. Maps generated by this software come with NO WARRANTY 
                of any kind and you use them at your own risk. 
            </para>
        </warning>
        <important>
            <para>
                Depending on the model and firmware version of the Garmin GPS, the maximum size 
                of the gmapsupp.img file is 4 or 2 Gb. If your file is larger than this, 
                the map will not be displayed.
            </para>
        </important>
        <note>
            <para>
                To decrease the size of the generated mapset, the region's boundaries can be 
                reduced or contour creation parameters adjusted. 
            </para>
            <para>
                If contour settings are changed, the contents of the contours directory 
                in the working directory must be deleted. 
            </para>
            <para>
                Generation of new contours can take a long time.
            </para>
        </note>
    </chapter>        
    <chapter xml:id="startup_options">
        <info>
            <title>Startup options</title>
        </info>
        <para>
            The program launcher (osm2garmin for Linux or osm2garmin.exe for Windows) supports 
            several startup options which control parameters of Java NetBeans. Startup options 
            can be listed by passing -h or --help as a startup option, e.g.:
        </para>
        <para>
            <literallayout>osm2garmin.exe --help</literallayout>
        </para>
        <section xml:id="more_memory">
            <info>
                <title>Assign more memory to the program</title>
            </info>
            <para>
                Java JRE works with a fixed-maximum-size heap memory space and will not use more memory 
                than it is allocated at startup. Thus, during processing it will not use more memory, 
                even if it is available on your system. Items influencing memory usage include running 
                multiple external tools, contour settings and region size.
            </para>
            <para>
                If running a 64bit system with 64bit JRE, the Java maximum memory size can be increased by:
            </para>
            <orderedlist>
                <listitem>
                    <para>
                        Starting program with -J-Xmx&lt;memsize&gt;m option where memsize is memory size in Mbytes, 
                        e.g. 
                        <literallayout>osm2garmin.exe -J-Xmx2000m</literallayout>
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Edit the configuration file osm2garmin.conf located at
                    </para>
                    <variablelist>
                        <varlistentry>
                            <term>Windows</term>
                            <listitem>
                                <programlisting>&lt;PROGRAM_FILES&gt;/osm2garmin_&lt;version&gt;/etc/osm2garmin.conf</programlisting>                                
                            </listitem>
                        </varlistentry>
                        <varlistentry>
                            <term>Linux</term>
                            <listitem>
                                <programlisting>/usr/local/osm2garmin_&lt;version&gt;/etc/osm2garmin.conf</programlisting>                                
                            </listitem>
                        </varlistentry>
                    </variablelist>
                    <para>
                        In the file replace 
                        <literallayout>-J-Xmx1400m</literallayout> 
                        with higher value, e.g. 
                        <literallayout>-J-Xmx2000m</literallayout>
                    </para>
                    <para>
                        In Windows Vista or 7 use a privileged editor by right-clicking 
                        Notepad, Start, menu shortcut and select "Run as administrator".                    
                    </para>
                </listitem>
            </orderedlist>
            <note>
                <para>
                    32 bit Java VM on both 32 bit and 64 bit Windows OS can not allocate 
                    more heap memory than approx. 1400m.
                </para>
            </note>
            <para>
                The starting heap memory size can be changed at 
                <literallayout>-J-Xms=&lt;memsize&gt;m</literallayout>  
                Note that Xms &lt;= Xmx.
            </para>
            <para>
                On 64 bit Windows systems with 64 bit JVM, additional parameter 
                <literallayout>-J-XX:MaxPermSize=&lt;memsize&gt;m</literallayout> 
                is often needed to avoid PermGenSpace overflow errors.
            </para>
            <para>
                To change the JRE to a different version, change the parameter 
                <literallayout>--jdkhome &lt;path-to-jre&gt;</literallayout>
                This can be useful e.g. if both 32 bit and 64 bit JVM is installed on
                a single computer. 
            </para>
            <para>
                Startup parameters can be added permanently to the program startup link, 
                e.g. associated to the program desktop icon. In Windows, right-click the icon, 
                select Properties and adjust the settings as needed
            </para>
            <para>
                Your Windows customized command line can look like:
            </para>
            <programlisting>c:\program files\osm2garmin_&gt;version&lt;\bin\osm2garmin.exe" -J-Xmx2000m --jdkhome "c:/program files/Java/jre6"</programlisting>
        </section>
    </chapter>
    <chapter xml:id="headless">
        <info>
            <title>Command-line processing</title>
        </info>
        <para>
            The Osm2garmin program offers a command-line, unattended mode where map generation 
            is performed in a single step with no user intervention.        
        </para>
        <para>
            The command-line module is invoked from a single 
            <emphasis>jar</emphasis> file available in the directory where the program
            is installed:
        </para>
        <programlisting>osm2garmin/modules/org-mantlik-osm2garmin.jar</programlisting>
        <para>
            Copy the file to your working directory and run the command
        </para>
        <programlisting>java -Xmx&lt;mamsize&gt;m -jar org-mantlik-osm2garmin.jar</programlisting>
        <para>
            On the first run, two files are created, 
            <emphasis>regions.txt</emphasis> and 
            <emphasis>settings.properties</emphasis>.
        </para>
        <para>
            Edit both files to meet your needs and run the program again. The complete
            downloading and processing cycle occurs.
        </para>
        <para>
            Repeating the unattended run will download OSM updates and create updated maps.
        </para>
    </chapter>
    <chapter xml:id="inst-uninst">
        <info>
            <title>Installation, Un-installation, Updating, Upgrading</title>
        </info>
        <section xml:id="system-requirements">
            <info>
                <title>System requirements</title>
            </info>
            <itemizedlist>
                <listitem>
                    <para>
                        Windows XP/Vista/7/8 or Linux 2.6+ or Max OSX 10
                    </para>
                </listitem>
            </itemizedlist>
            <itemizedlist>
                <listitem>
                    <para>
                        Minimum 2 Gb of RAM and 200 Gb of free disk space
                    </para>
                </listitem>
            </itemizedlist>
            <itemizedlist>
                <listitem>
                    <para>
                        Sun Java JRE 6 or newer 64 or 32 bit
                    </para>
                    <para>
                        Java must be downloaded and installed separately from 
                        <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://java.com/download">http://java.com/download</link>.
                    </para>
                </listitem>
            </itemizedlist>
            <note>
                <para>
                    With 32 bit Java VM, some functions of the Osm2garmin software are not available.
                </para>
                <para>
                    Osm2garmin is a processor intensive program and while it requires sufficient 
                    memory to generate maps, performance is increased with fast, 64 bit multi-core processors. 
                    At least 4Gb of ram, 500Gb of disc space and 64 bit multi-core processor(s) is a recommended 
                    configuration.
                </para>
            </note>
        </section>
        <section xml:id="install">
            <info>
                <title>Installation</title>
            </info>
            <para>
                Download the installer (stable or unstable version) for your os from:
                <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://code.google.com/p/osm2garmin/downloads">http://code.google.com/p/osm2garmin/downloads</link>
            </para>
            <para>
                Check that Java JRE 6 or newer is installed.
            </para>
            <para>
                Change to the directory where you downloaded the Osm2garmin installer and:
            </para>
            <variablelist>
                <varlistentry>
                    <term>Windows and MacOSX</term>
                    <listitem>
                        <para>
                            Double click on the installer file.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Linux</term>
                    <listitem>
                        <para>
                            Allow executing file as program.
                        </para>
                        <para>
                            In a terminal window type:
                        </para>
                        <programlisting>sudo ./&lt;program name&gt;.sh &lt;enter&gt;
                        </programlisting>
                    </listitem>
                </varlistentry>
            </variablelist>
            <para>
                Complete installation using the provided Installer Wizard which installs 
                Osm2garmin to a user determined folder.
            </para>
        </section>
        <section xml:id="uninstall">
            <info>
                <title>Un-installation</title>
            </info>
            <variablelist>
                <varlistentry>
                    <term>Windows</term>
                    <listitem>
                        <para>
                            Uninstall the program from Control Panels - Add and remove programs / Programs and functions.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Linux and MacOSX</term>
                    <listitem>
                        <para>
                            Change to 
                            <literallayout>/usr/local&lt;program name&gt;</literallayout>
                        </para>
                        <para>
                            In a terminal window type:
                        </para>
                        <programlisting>sudo ./uninstall.sh &lt;enter&gt;
                        </programlisting>
                    </listitem>
                </varlistentry>
            </variablelist>
            <para>
                Complete using the Uninstall Wizard.
            </para>
        </section>
        <section xml:id="upgrade">
            <info>
                <title>Upgrading</title>
            </info>
            <para>
                The software regularly checks for new releases. When new version was published,
                update wizard is offered automatically.
            </para>
            <para>
                If you want to check for new version manually, you can select Help -
                Check for updates.
            </para>
            <para>
                Complete upgrade using the Upgrade Wizard. Osm2garmin must be restarted after 
                upgrade is finished.
            </para>
            <note>
                <para>
                    It is not recommended to run Upgrade Wizard when maps generation is in progress.
                </para>
            </note>
        </section>
        <section xml:id="unstable-version">
            <info>
                <title>Unstable (development) version</title>
            </info>
            <para>
                Unstable version of the software implements the newest features 
                not yet included in the stable version.
            </para>
            <para>
                More information concerning unstable version including detail instructions
                how to switch your installation of the Osm2garmin software into
                unstable version can be found here:
            </para>
            <para>
                <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://code.google.com/p/osm2garmin/wiki/UnstableVersionHowto">https://code.google.com/p/osm2garmin/wiki/UnstableVersionHowto</link>            
            </para>
        </section>
    </chapter>
    <appendix xml:id="faq">
        <info>
            <title>Frequently asked questions</title>
        </info>
        <variablelist>
            <?dbfo list-presentation="blocks"?>
            <varlistentry>
                <term>Is the program still running?</term>
                <listitem>
                    <para>
                        Osm2garmin takes a long time to generate maps, particularly the first time 
                        it runs because many Gigabytes of Planet and SRTM data must be downloaded 
                        and processed.  
                    </para>
                    <para>
                        In the main program window, check the processing boxes for status information 
                        and the “Output – Osm2garmin” window for activity messages. If the status is 
                        not changing for a long time (e.g. if “processing maps completed xx%” is not increasing) 
                        or there are no activity messages, then the program has probably stalled. 
                    </para>
                    <para>
                        You can view the Resources tab of the System Monitor program of your system, 
                        your processor(s), disk(s) and/or network should be highly active.
                    </para>
                    <para>
                        If the programm has stalled, Select “Stop”, “exit” then “ok”.  Run again and consider 
                        increasing Java maximum memory heap size and/or changing program parameters.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Updating is taking a long time.</term>
                <listitem>
                    <para>
                        Yes, it does. All 2 billion nodes and 200 million ways in the planet file must be 
                        checked and updated. Selecting the “Skip planet update” box prevents the downloading 
                        and updating of the planet file if you would like to process new/updated regions with
                        existing OSM data.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Create Contours box reports "Null".</term>
                <listitem>
                    <para>
                        This indicates that that the contour creation process failed. 
                        Try re-running the program.                    
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Out of memory?</term>
                <listitem>
                    <para>
                        The error message will depend on which situation caused the problem. 
                        Examine output window and log files.                    
                    </para>
                    <para>More information: 
                        <link linkend="more_memory">Assign more memory to the program</link>
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>utput tab reports “Attention: Data being output lacks metadata. Please use omitmetadata=true”</term>
                <listitem>
                    <para>
                        This is a bug in the Osmosis external tool which falsely reports this error message, 
                        as Osm2garmin does not use OSM metadata. The message can be safely ignored.                    
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>How can I view my maps?</term>
                <listitem>
                    <para>
                        In Windows, Maps created by Osm2garmin can be viewed in MapSource/Basemap by using the installer.bat 
                        in each region's subdirectory.  
                    </para>
                    <para>
                        QlandkarteGT (Linux, Mac, Win) can also display Osm2garmin maps by selecting File, 
                        Load Map, the osmmap.tdb and then osmmap_mdr.img file for the region of interest.  
                        You may have to zoom in a number of times to see details of your map.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Contours but not OSM data is displayed.</term>
                <listitem>
                    <para>
                        If this is the first time you are processing a new region and the 
                        “Skip Planet Update” option is checked, then Osm2garmin did not create 
                        the 7xxxxxx.img OSM data files. Check the region's subdirectory to verify 
                        that these files were not created. Un-select the “Skip planet update” 
                        and re-run the program.                    
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>OSM data but no contours are displayed on the GPS</term>
                <listitem>
                    <para>
                        In version 1.1 of the software there is a bug that prevents contours from being displayed
                        for regions with negative Lat/Long values under some circumstances. Please upgrade to newer version.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Why is OSM Planet downloading again?</term>
                <listitem>
                    <para>
                        If your planet file is older than 12 of September 2012, it was released under old
                        CC-BY-SA License while newer versions are released under ODbL License. License terms 
                        do not allow update of CC-BY-SA licensed data with ODbL data. Osm2garmin software has to 
                        download latest available ODbL Planet file and use it for any further updates.
                    </para>
                    <para>
                        This is a one-time event only, it should never happen again. 
                        OpenStreetMap Foundation is sorry for inconvenience.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>Where can I get more information on the external tools?</term>
                <listitem>
                    <para>
                        Mkgmap - 
                        <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.mkgmap.org.uk/">http://www.mkgmap.org.uk/</link>
                    </para>
                    <para>
                        Splitter - 
                        <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://www.mkgmap.org.uk/doc/splitter.html">http://www.mkgmap.org.uk/doc/splitter.html</link>
                    </para>
                    <para>
                        Osmosis - 
                        <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://wiki.openstreetmap.org/wiki/Osmosis">http://wiki.openstreetmap.org/wiki/Osmosis</link>
                    </para>
                </listitem>
            </varlistentry>
        </variablelist>
    </appendix>
    <appendix xml:id="contours-generation">
        <info>
            <title>Contours generation</title>
        </info>
        <para>
            Contour generation is a complex process and the following explanation provides a 
            “high level” overview.  Nevertheless it should provide the user with enough information 
            to adjust contour settings.
        </para>
        <para>
            We begin with a description of Osm2garmin's data structure, terminology and 
            the steps to generate contours.
        </para>
        <formalpara>
            <info>
                <title>The data structure used for contour generation is based on:</title>
            </info>
            <para>
                <simplelist>
                    <member>
                        SRTM raster cells (appx. 90x90 meters) which contain position and elevation data.
                    </member>  
                    <member>
                        Cells are combined into 1x1 degree tiles (appx. 111x111 kilometers 
                        – see below), each tile contains approximately 1.5 million cells.
                    </member>
                    <member>
                        Tiles are combined into contour files. 
                    </member>
                </simplelist>
            </para>
        </formalpara>
        <formalpara>
            <info>
                <title>Terminology:</title>
            </info>
            <para>
                <variablelist>
                    <varlistentry>
                        <term>Elevation difference</term>
                        <listitem>
                            <para>
                                difference between the lowest and highest elevation points in a tile
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Elevation difference threshold</term>
                        <listitem>
                            <para>
                                the “break point” that determines which “group” a tile is assigned to
                            </para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Contour interval</term>
                        <listitem>
                            <para>distance (elevation) between contours</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Contour density</term>
                        <listitem>
                            <para>number of contours in a single tile</para>
                        </listitem>
                    </varlistentry>
                    <varlistentry>
                        <term>Tiles in a file</term>
                        <listitem>
                            <para>number of tiles combined into a contour file</para>
                        </listitem>
                    </varlistentry>
                </variablelist>
            </para>
        </formalpara>
        <para>
            The steps to generate contours begin with examining each tile, calculating the 
            tile's elevation difference and assigning it to one of three processing groups 
            (minor, intermediate or major). Contours are then generated for each file based on the contour 
            interval value for the group.  The contour density of each tile is checked and adjoining 
            tiles are combined into files.  These contour files are compressed for future use and converted 
            into Garmin .img files.  
        </para>
        <para>
            Processing using external tools occurs at each step. Complicating this process is 
            that users can adjust program settings at each stage of processing and the settings 
            interact with each other, sometimes in unexpected ways.  
        </para>
        <para>
            Garmin GPS devices display two “types” of contours, regular and major (indicated by a thicker 
            contour line) but these contours do not relate to the 3 groups discussed above. 
            Rather, a contour is selected for each tile and a major is selected a group higher.
        </para>
        <para>
            E.g. if for a particular tile, minor contour group will be created, each contour falling into
            intermediate group will be marked "major" for Garmin. Similarly, if intermediate contours will be
            created, each contour corresponding to major contour interval will be marked as "major" etc.
        </para>
        <para>
            To generate contours for continental sized regions, with their varying elevation profiles 
            and to keep map file size reasonable, Osm2garmin organizes tiles into three processing “groups” 
            (minor, intermediate and major). Using 3 groups (each with an associated contour interval) 
            allows contours to be displayed in flat, intermediate and mountainous regions in reasonable spacing.  
            The alternative, a “one size fits all” contour processing, can result in widely spaced and/or 
            highly bunched contours, making GPS viewing and navigation difficult. 
        </para>
        <para>
            Example:
        </para>
        <para>
            The state of Colorado in the USA has a low, flat plain in the east, a high mountainous center 
            and a mid level plateau in the west.  Setting threshold values of 1500 minor and 5000 medium 
            will generate minor contours for each 1x1 degree SRTM tile where elevation difference between the highest 
            and the lowest point will be less than 1500 m, i.e. on the eastern plains where relief is low. 
            In the rest of the area, intermediate contours will be created, because the elevation difference never exceeds 
            5000 m in a single SRTM tile.
        </para>
        <para>
            The longitudinal width of SRTM tiles varies with latitude approximately as follows:
        </para>
        <simplelist>
            <member>111 km at 0 degrees</member>
            <member>96 km at 30 degrees</member>
            <member>79 km at 45 degrees</member>
            <member>56 km at 60 degrees</member>
        </simplelist>
    </appendix>
    <xi:include href="license.xml"/>    
</book>
