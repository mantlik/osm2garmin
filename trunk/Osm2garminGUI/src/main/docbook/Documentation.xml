<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML 5.0//EN" "http://docbook.org/ns/docbook/DTD/docbook.dtd" >

<book xmlns="http://docbook.org/ns/docbook" 
      xmlns:xi="http://www.w3.org/2001/XInclude"
      version="5.0" xml:id="guide-index">
    <info>
        <title>OpenStreetMap Garmin Maps Generator</title>
        <subtitle>User's guide</subtitle>
        <mediaobject>
            <imageobject>
                <imagedata fileref="splash.png"/>
            </imageobject>
        </mediaobject>
        <copyright>
            <year>      
                <?dbtimestamp format="Y"?>
            </year>
            <holder>RNDr. Frantisek Mantlik</holder>
        </copyright>
    </info>
    <chapter xml:id="getting-started">
        <info>
            <title>Getting started</title>
        </info>
        <section>
            <info>
                <title>Quick start</title>
            </info>
            <para>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="application.png"/>
                    </imageobject>
                </mediaobject>
            </para>
            <itemizedlist>
                <listitem>
                    <para>
                        Click 
                        <inlinemediaobject>
                            <imageobject>
                                <imagedata fileref="Globe32.png"/>
                            </imageobject> 
                        </inlinemediaobject> or select Tools-Options to adjust
                        program settings. Click appropriate tab for desired settings group.
                    </para>
                    <para>
                        Default settings will produce a set of Garmin maps covering the whole globe. You can
                        adjust all settings according to your needs.
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Click "Start" to run maps download and generation.                        
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Wait until maps download and creation process is finished. It can take 
                        long time, especially on the first run.                        
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Copy desired maps to the GARMIN folder of the memory card of your Garmin instrument 
                        and/or install maps into MapSource.                    
                    </para>
                </listitem>
                <listitem>
                    <para>
                        Repeat the procedure on regular basis in order to download and process 
                        actualizations of your maps.                        
                    </para>
                </listitem>
            </itemizedlist>
        </section>
    </chapter>
    <chapter xml:id="settings">
        <info>
            <title>Program settings</title>
        </info>
        <section xml:id="sources">
            <info>
                <title>Download sources</title>
            </info>
            <para>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="download_sources.png"/>
                    </imageobject>
                </mediaobject>
            </para>
            <variablelist>
                <?dbfo list-presentation="blocks"?>
                <varlistentry>
                    <term>SRTM3 download URL</term>
                    <listitem>
                        <para>
                            URL for downloading SRTM data from. If local/company mirror of SRTM3 data
                            is available, default value can be replaced with the mirror. Please note that
                            HTTP protocol only is supported.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Torrents download URL</term>
                    <listitem>
                        <para>
                            URL from where planet file torrents can be downloaded. Under normal circumstances there
                            is no need to change the default value.
                        </para>
                        <para>
                            This option affects BitTorrent download only.                            
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Planet file download mirrors</term>
                    <listitem>
                        <para>
                            List of planet download mirrors for HTTP downloads one per line. Download mirror
                            is randomly selected.
                        </para>
                        <para>
                            This option affects HTTP download only.                            
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Planet update mirrors</term>
                    <listitem>
                        <para>
                            List of mirrors for routine updates one item per line. Update mirrors are randomly
                            selected each run.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Download method</term>
                    <listitem>
                        <para>
                            Select method for initial planet file download. Default method is BitTorrent.                            
                        </para>
                        <para>
                            This option affects initial Planet file download only. Later updates are downloaded
                            from mirror sites with the use of Osmosis tool.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>BitTorrent port range</term>
                    <listitem>
                        <para>
                            Select range of ports used for BitTorrent download. First available port from the
                            range will be used.
                        </para>
                        <para>
                            In order to achieve the best download performance, port accessible from the whole Internet
                            should be selected if possible.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>BitTorrent maximum speed</term>
                    <listitem>
                        <para>
                            Speed limit for BitTorrent downloading in kb/s. Zero means no limit (default).
                        </para>
                        <para>
                            Changes will only take place after program restart.
                        </para>
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>
        <section xml:id="parameters">
            <info>
                <title>Processing parameters</title>
            </info>
            <para>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="parameters.png"/>
                    </imageobject>
                </mediaobject>
            </para>
            <variablelist>
                <?dbfo list-presentation="blocks"?>
                <varlistentry>
                    <term>Working directory</term>
                    <listitem>
                        <para>
                            Directory for saving all program data. Please note that software needs at least
                            150-200 Gbyte of free space to save all maps data.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Maps directory</term>
                    <listitem>
                        <para>
                            Directory where final maps will be saved. Each region will be saved in a subdirectory
                            named after the particular region.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>SRTM data directory</term>
                    <listitem>
                        <para>
                            Directory where mirror of the SRTM3 data will be saved. If you have a SRTM mirror
                            available in the filesystem, you can point this directory. Data available in this
                            directory will not be downloaded from the Internet.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Contours interval</term>
                    <listitem>
                        <para>
                            Minor, medium and major contours interval. Minor contours are plotted in flat areas
                            only and medium contours are not plotted in high mountains.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Elevation difference threshold</term>
                    <listitem>
                        <para>
                            Elevation difference threshold for each 1x1 degree tile to plot minor resp.
                            medium contours. If the overall elevation difference in the tile exceeds a
                            threshold, corresponding contours are not plotted.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>SRTM contours shift correction</term>
                    <listitem>
                        <para>
                            In some regions, SRTM data seem to have a systematic shift
                            half a cell diagonal size, i.e. approx. 50-60 m to the SW. 
                            If your generated map is possessed with the problem, correction of
                            1/2400 = 0.0004167 degree in both directions will put contours 
                            to the right place.
                        </para>
                        <para>
                            Contours directory must be cleaned in order to reprocess SRTM data.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Exclusive run of external tools</term>
                    <listitem>
                        <para>
                            If checked, no simultaneous run of more than one external tool, such as Osmosis,
                            Mkgmap or Splitter is allowed. Useful in case of out-of-memory problems.
                        </para>
                        <para>
                            <link linkend="more_memory">Assign more memory to the program</link> section gives some tips how to increase amount
                            of memory assigned to the program.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Delete old maps when processing starts</term>
                    <listitem>
                        <para>
                            Cleanup at the beginning of processing when checked. Downloaded OSM data and computed
                            contours are not deleted.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Generate all cycling features</term>
                    <listitem>
                        <para>
                            Generate cycling path even when running parallel to the road.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>No. of SRTM3 tiles in a single contours file</term>
                    <listitem>
                        <para>
                            Degree of aggregation of SRTM tiles (1x1 degree). Higher number makes final map smaller
                            but increases overlap at region boundaries.
                        </para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term>Maximum number of contours in a single 3x3 arc sec cell</term>
                    <listitem>
                        <para>
                            If more minor contours appear in a single cell, no minor contours are plotted in the cell.
                            The same rule applies for major contours.
                        </para>
                    </listitem>
                </varlistentry>
            </variablelist>
        </section>
        <section xml:id="regions">
            <info>
                <title>Regions</title>
            </info>
            <para>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="regions.png"/>
                    </imageobject>
                </mediaobject>
            </para>
            <para>
                Regions table defines individual regions for processing. Each rectangular region is defined
                by a unique name and bounding coordinates.
            </para>
            <para>
                Regions are processed from top to the bottom of the list. You can change the sequence
                with the Move up and Move down buttons. Uncheck the "Enabled" box to disable the region
                from processing.
            </para>
            <para>
                Display button will open the schematic map of the
                region in the external browser. In addition, HTML page with the region map link is saved
                in the working directory.
            </para>
        </section>
    </chapter>
    <chapter xml:id="startup_options">
        <info>
            <title>Startup options</title>
        </info>
        <para>
            Program executable (osm2garmin.exe for Windows or osm2garmin for Linux) supports several startup options
            controlling parameters of the running Java virtual machine. All possible startup options can be listed by
            passing -h or --help as a startup option, e.g.:
        </para>
        <para>
            <literallayout>osm2garmin.exe --help</literallayout>
        </para>
        <section xml:id="more_memory">
            <info>
                <title>Assign more memory to the program</title>
            </info>
            <para>
                If running on 64bit system with 64bit JRE, memory limit can be increased with the use of one of the 
                following methods:
            </para>
            <orderedlist>
                <listitem>
                    <para>
                        Start program with -J-Xmx&lt;memsize&gt;m option where memsize is memory heep size in Mbytes, 
                        e.g. osm2garmin.exe -J-Xmx2000m
                    </para>
                    <para>
                        In addition, if you would like to use different JRE, add the parameter --jdkhome &lt;path-to-jre&gt;
                    </para>
                    <para>
                        Your customized command line can look e.g. like this:
                    </para>
                    <para>
                        <literallayout>"c:\program files\osm2garmin_1.0\bin\osm2garmin.exe" -J-Xmx2000m --jdkhome "c:/program files/Java/jre6"</literallayout>
                    </para>
                    <tip>
                        <para>
                            Startup parameters can be added permanently to the program startup link, e.g. associated
                            to program desktop icon. In Windows, right-click the icon, select Properties and adjust
                            the settings as needed.
                        </para>
                    </tip>
                </listitem>
                <listitem>
                    <para>
                        Edit the configuration file located at
                    </para>
                    <programlisting>&lt;PROGRAM_FILES&gt;/osm2garmin_&lt;version&gt;/etc/osm2garmin.conf</programlisting>
                    <para>
                        In the file replace -J-Xmx1400m with higher value, e.g. -J-Xmx2000m.
                    </para>
                    <para>
                        You can edit osm2garmin.conf in privilegued editor only in Windows Vista or 7. Right-click your Notepad
                        Start menu shortcut and select "Run as administrator" item.
                    </para>
                </listitem>
            </orderedlist>
        </section>
    </chapter>
    <chapter xml:id="results">
        <info>
            <title>Working with processed maps</title>
        </info>
        <para>
            When maps processing finished, bunch of new files are created in each region subdirectory of the
            Maps directory:
        </para>
        <variablelist>
            <?dbfo list-presentation="blocks"?>
            <varlistentry>
                <term>gmapsupp.img</term>
                <listitem>
                    <para>
                        Compiled mapset for your Garmin unit. This file has to be copied to the GARMIN folder at the
                        memory card of your unit. Most Garmin instruments support only one mapset at a time.
                    </para>
                    <para>
                        Depending on the model and firmware version of the Garmin unit, maximum size of the gmapsupp.img file is 4 Gb
                        or 2 Gb. In addition, maximum file size in FAT32 filesystem is 4 Gb. If your
                        generated gmapsupp.img file exceeds the limits, generated map will not work in the unit.
                    </para>
                    <para>
                        In order to lower size of the generated mapset, region can be made smaller or contours creation
                        parameters can be adjusted. If contours settings are changed, contents of the contours directory
                        in the working directory has to be deleted. Generation of new contours can take long time.
                    </para>
                    <warning>
                        <para>
                            Do not delete commercial maps from a memory card. Use a new card instead. Maps generated by this software
                            come with NO WARRANTY of any kind and use them on your own risk only.
                        </para>
                    </warning>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>&lt;NNNNNNNN&gt;.img</term>
                <listitem>
                    <para>
                        Numbered individual maps tiles which were compiled together to gmapsupp.img in the final step of a region
                        processing. These files can be registered to Mapsource.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>installer.bat</term>
                <listitem>
                    <para>
                        Script to register region maps to Mapsource. Creates necessary registry items needed for Mapsource
                        to recognize your newly generated maps.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>uninstaller.bat</term>
                <listitem>
                    <para>
                        Script to uninstall maps from MapSource. You have to uninstall and reinstall all maps if you change
                        number of regions or order of individual regions in the Regions table.
                    </para>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>osmmap.nsi</term>
                <listitem>
                    <para>
                        Install script for the Nullsoft Scriptable Install System (NSIS). You can install NSIS from
                        <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://nsis.sourceforge.net"/>.
                        When NSIS is installed, Mapsource installer can be created using MakeNSIS or MakeNSISW.
                        Generated installer can be used to install generated maps in any number of computers.
                    </para>
                    <para>
                        When generated installer &lt;region_name&gt;.exe is run at a destination computer, all maps
                        are unpacked to c:\garmin\maps\&lt;region_name&gt; by default. Maps can be un-installed and deleted standard
                        "Windows" way, i.e. using "Add/remove programs" or "Programs and functions" control panel item.
                    </para>
                    <note>
                        <para>
                            If map size exceeds 2Gb, installer creation can fail because of default /SOLID compressor parameter 
                            in osmmap.msi script. To avoid the problem, either remove "/SOLID" parameter from SetCompressor 
                            command in the script, or use /X"SetCompressor /FINAL LZMA" startup parameter for MakeNSIS.
                        </para>
                        <para>
                            MakeNSIS command can look e.g. like this:
                        </para>
                        <programlisting>"C:\Program Files\NSIS\makensis.exe" /X"SetCompressor /FINAL lzma" osmmap.nsi</programlisting>
                        <para>
                            Even without "/SOLID" parameter, total size of resulting installer file cannot exceed 2 Gb, 
                            which corresponds to gmapsupp.img size approx. 3 Gb.
                        </para>
                        <para>
                            Maps installed via NSIS installer are not compatible with installer.bat / uninstaller.bat method. 
                            Uninstaller.bat will NOT uninstall maps installed via NSIS and vice versa.
                        </para>
                    </note>
                </listitem>
            </varlistentry>
            <varlistentry>
                <term>osmmap.*</term>
                <listitem>
                    <para>
                        Various files needed by MapSource. Do not delete them if you want to register map in MapSource
                        using installer.bat / uninstaller.bat.
                    </para>
                </listitem>
            </varlistentry>
        </variablelist>
    </chapter>        
    <chapter xml:id="headless">
        <info>
            <title>Command-line processing</title>
        </info>
        <para>
            Program offers command-line unattended mode. In this mode, processing
            is performed in a single step with no user intervention.
        </para>
        <para>
            Command-line module is represented by a single 
            <emphasis>jar</emphasis> file available in the
            program distribution:
        </para>
        <programlisting>osm2garmin/modules/org-mantlik-Osm2garminAPI.jar</programlisting>
        <para>
            Simply copy the file to your working directory and run the command
        </para>
        <programlisting>java -Xmx1400m -jar org-mantlik-Osm2garminAPI.jar</programlisting>
        <para>
            On the first run, two files are created, 
            <emphasis>regions.txt</emphasis> and 
            <emphasis>settings.properties</emphasis>.
        </para>
        <para>
            Edit both files to meet your needs and run the program again. The whole
            download and processing cycle will take place.
        </para>
        <para>
            You can repeat the unattended run at any time. Maps updates are downloaded
            and updated versions of maps are prepared.
        </para>
    </chapter>
    <xi:include href="license.xml"/>    
</book>
